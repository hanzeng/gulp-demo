<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>案例详情</title>
    <meta name=”description” content=”擎锋科技是一家致力于AR增强现实技术研究和应用的高科技公司，为企业和消费者提供增强现实AR解决方案。”>
    <meta name=”keyword” content="擎锋科技，ar，Seego，72变，添翼，APP方案定制，AR方案定制">
    <!--IE=edge告诉IE使用最新的引擎渲染网页，chrome=1则可以激活Chrome Frame.-->
    <meta http-equiv="X-UA-Compatible" content="IE=7,IE=9">
    <meta http-equiv="X-UA-Compatible" content="IE=7,9">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <!--兼容IE8-->
    <link rel="shortcut icon" href="/bitbug_favicon.ico" />
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/index.css">
</head>
<body class="uploadInfo">
<div class='header case-header'>
    <div class='nav clearfix'>
        <div class='logo'>
            <a href="index.html">
                <img src='images/nav_logo.png' alt=''>
            </a>
        </div>
        <div class='navli'>
            <ul class='clearfix'>
                <li>
                    <a class='rootA' href='about.html'>关于我们</a>
                </li>
                <li>
                    <a class='rootA' href='product.html'>产品中心</a>
                </li>
                <li class='act'>
                    <a class='rootA' href='case-show.html'>案例展示</a>
                </li>
                <li>
                    <a class='rootA' href='our-service-app.html'>
                        服务介绍
                    </a>
                    <div class='subhead'>
                        <a href='our-service-app.html'>APP方案定制</a>
                        <a href='our-service-ar.html'>AR方案定制</a>
                    </div>
                </li>
                <li>
                    <a class='rootA' href='index.html'>首页</a>
                </li>
            </ul>
            <i class='navLine'></i>
        </div>
        <div class="personal"></div>
    </div>
</div>
<div class="con">
    <div class="uploadInfo-con">
        <ol class="breadcrumb clearfix">
            <li><a href="case-show.html">案例展示 </a> ><a class="backCase"> </a> ></li>
            <li class="active">上传项目资料</li>
        </ol>
        <div class="content">
            <div class="item item-title">
                <h5>项目信息</h5>
            </div>
            <div class="item clearfix">
                <label>项目名称<i>*</i></label>
                <input class="ipt name" type="text" placeholder="请填写项目名称" />
                <p class="hint iconfont">&#xe627;<span>请填写项目名称</span></p>
            </div>
            <div class="item clearfix">
                <label>项目图标上传</label>
                <div class="add-con">
                    <div class="add">
                        <a class="pic projLogo" href="javascript:;">
                            <img src="" id="myPhoto" alt="">
                            <span class="iconfont">&#xe652;</span>
                            <input type="file" id="file2" />
                        </a>
                    </div>
                    <p class="tag">1.须2M以内，JPG/PNG格式的图片； <br /> 2.若需另行设计可不用上传。</p>
                </div>
            </div>
            <div class="item clearfix">
                <label>识别图标上传</label>
                <div class="add-con">
                    <div class="add clearfix">
                        <div class="picList"></div>
                        <a class="pic" id="addPicture" href="javascript:;">
                            <span class="iconfont">&#xe652;</span>
                            <input type="file" id="filee" />
                        </a>
                    </div>
                    <p class="tag">1.须2M以内，JPG/PNG格式的图片；<br /> 2.最多可上传5张识别图，识别图的多少与最终报价成正比。</p>
                </div>
            </div>
            <div class="item item-title">
                <h5>附加选项</h5>
            </div>
            <div class="item item-check clearfix">
                <label class="on">
                    <span class="iconfont">&#xe602;</span>
                    <input type="checkbox" name="opt" checked value="视频制作">视频制作
                </label>
                <label>
                    <span class="iconfont">&#xe602;</span>
                    <input type="checkbox" name="opt" value="官网或其他链接">官网或其他链接
                </label>
                <label>
                    <span class="iconfont">&#xe602;</span>
                    <input type="checkbox" name="opt" value="3D模型重设计">3D模型重设计
                </label>
            </div>
            <div class="item item-title">
                <h5>联系方式</h5>
            </div>
            <div class="item clearfix">
                <label>联系人姓名<i>*</i></label>
                <input class="ipt userName" type="text" maxlength="20" placeholder="请填写联系人姓名" />
                <p class="hint iconfont">&#xe627;<span>请填写联系人姓名</span></p>
            </div>
            <div class="item clearfix">
                <label>联系电话<i>*</i></label>
                <input class="ipt isMobile userTel" type="text" maxlength="11" placeholder="请填写联系电话" />
                <p class="hint iconfont">&#xe627;<span>请填写有效的11位数字的手机号码</span></p>
            </div>
            <!--<div class="item clearfix">-->
                <!--<label>验证码<i>*</i></label>-->
                <!--<input class="auth-ipt" type="text">-->
                <!--<img class="auth-code" src="" alt="">-->
                <!--<p class="hint iconfont">&#xe627;<span>请填写验证码</span></p>-->
            <!--</div>-->
            <div class="item">
                <p class="tag">
                    1.以上带<i>*</i>项为必填项;<br />
                    2.项目将会在1-3个工作日之后完成报价，并与您取得联系;<br />
                    3.有任何疑问可通过右侧咨询框与我们取得联系，我们将竭诚为您服务！
                </p>
            </div>
            <div class="item item-btn">
                <a class="back-btn" href="javascript:;">返回上一步</a>
                <a class="sub-btn" href="javascript:;">提交</a>
            </div>
        </div>
    </div>

    <script src="js/foot.js"></script>
</div>


<!--[if !IE]> -->
<script src="js/jquery-2.1.4.min.js"></script>
<!-- <![endif]-->

<!--[if lte IE 8]>
<script src="js/jquery-1.6.4.min.js"></script>
<![endif]-->

<!--[if gt IE 8]>
<script src="js/jquery-2.1.4.min.js"></script>
<![endif]-->
<script src="http://api.html5media.info/1.1.8/html5media.min.js"> </script>

<script src="js/rem100.js"></script>
<script src="js/index.js"></script>
<script src="js/verify.js"></script>
<script>
    var Houst = 'http://web.72change.net';
    var result = localStorage.getItem('result');
    if(result){
        result = JSON.parse(result);
    }
    //上传项目资料=========================
    //多图上传 识别图标上传================================
    var imgLength = 0;
    //图片的本地url的数组
    var photoArr = [];
    //已经上传至七牛服务器的图片url数组
    var ArrImg = [];
    var sizeArr = [];
    var file = document.getElementById('filee');

    //================================
    //       从相册获取图片保存着
    //================================
    file.onchange = function () {
        var fr = new FileReader();

        if (file.files.length > 0) {
            fr.readAsDataURL(file.files[0]);
            var size = file.files[0].size;
            sizeArr.push(size);

            fr.onload = function (e) {
                photoArr.push(e.target.result);
                imgLength ++;
                //$scope.$apply();
                $('.picList').append($('<a class="pic">\n' +
                    '                                <img src="'+ e.target.result +'" alt="">\n' +
                    '                                <i class="delPic iconfont">&#xe627;</i>\n' +
                    '                            </a>'));

                if (imgLength >= 5) {
                    var addPicture = document.getElementById('addPicture');
                    addPicture.style.display = "none";
                }
                //获取七牛token
                $.ajax({
                    url : Houst + '/api/cust/getQiniuToken',
                    type: 'GET',
                    dataType: 'JSON',
                    success : function(de){
                        if(de.code==1){
                            var qnToken = de.result;
                            putb64(e.target.result, qnToken, size);
                            return file;
                        }
                    },
                    error:function(){
                        alert('请求超时')
                    }
                });

            };
        }
    };
    //  删除图片
    $('.picList').on('click','.pic',function() {
        var addPicture = document.getElementById('addPicture');
        if(photoArr.length < 5){
            addPicture.style.display = "block";
        }
        var idx = $(this).index();
        setTimeout(function() {
            photoArr.splice( idx, 1);
            sizeArr.splice( idx, 1);
            ArrImg.splice( idx, 1);
            imgLength--;
            $('.picList').find('.pic').eq(idx).remove();
            console.log(ArrImg);
        },100);
    });


    //单图上传 项目图标上传===============
    var file2 = document.getElementById('file2');
    //已经上传至七牛服务器的图片url数组
    var KeyImg = '';
    file2.onchange = function () {
        var fr = new FileReader();
        if (file2.files.length > 0) {
            fr.readAsDataURL(file2.files[0]);
            var size = file2.files[0].size;
            var isLt2M = size / 1024 / 1024 < 2;
            if (!isLt2M) {
                alert('上传图片大小不能超过 2MB!');
                return false;
            }
            fr.onload = function (e) {
                $('#myPhoto').attr('src', e.target.result).siblings('span').addClass('act');
                $.ajax({
                    url : Houst + '/api/cust/getQiniuToken',
                    type: 'GET',
                    dataType: 'JSON',
                    success : function(de){
                        if(de.code==1){
                            var qnToken = de.result;
                            putb64(e.target.result, qnToken, size, 2);
                            return file2;
                        }
                    },
                    error:function(){
                        alert('请求超时');
                    }
                });
            };
        }
    };


    //提交事件
    // 上传项目资料==================================
    $('.uploadInfo').find('.item-check').on('click','label',function() {
        if ($(this).find('input').is(":checked")) {
            $(this).addClass('on');
            $(this).find('input').prop("checked", true);
        }else{
            $(this).removeClass('on');
            $(this).find('input').prop("checked", false);
        }
    });

    $('.uploadInfo').on('click','.sub-btn',function() {
        commite();
    });


    //================================
    //          将图片上传至七牛
    //================================
    function putb64(picture, token, size, type) {
        var pic = picture.split(',')[1];
        var url = "http://upload-z2.qiniu.com/putb64/" + size; //非华南空间需要根据注意事项 1 修改上传域名
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4) {
                var obj = JSON.parse(xhr.responseText);
                if(type == 2){
                    KeyImg = obj.key;
                }else{
                    ArrImg.push(obj.key);
                }
            }
        };
        xhr.open("POST", url, true);
        xhr.setRequestHeader("Content-Type", "application/octet-stream");
        xhr.setRequestHeader("Authorization", "UpToken " + token);
        xhr.send(pic);
    }

    function commite() {
        var name = $('.uploadInfo').find('.name').val();
        var userName = $('.uploadInfo').find('.userName').val();
        var userTel = $('.uploadInfo').find('.userTel').val();
        var projFuc = [];
        $('.uploadInfo').find('.item-check label').each(function() {
            if($(this).find('input').is(':checked') == true){
                projFuc.push($(this).find('input').val());
            }
        });
        if(!name){
            alert('请填写项目名称');
            return false;
        }else if(!userName) {
            alert('请填写联系人姓名');
            return false;
        }else if(!userTel) {
            alert('请填写联系方式');
            return false;
        }
        $('body').append($('<div class="loading">\n' +
            '    <img src="images/loading.gif" alt="">\n' +
            '</div>'));
        var creator;
        if(result){
            creator = result.custName;
        }else{
            creator = '';
        }
        $.ajax({
            url : Houst + '/api/proj/addProject',
            type: 'POST',
            dataType: 'JSON',
            data: {
                projName: name,
                projLogo: KeyImg,
                projPic1: ArrImg[0],
                projPic2:  ArrImg[1],
                projPic3:  ArrImg[2],
                projPic4:  ArrImg[3],
                projPic5:  ArrImg[4],
                projFuc: projFuc.join(","),
                userName: userName,
                userMobile: userTel,
                projPrice: undefined,
                projType: undefined,
                createName:  creator
            },
            success : function(){
                $('body').remove('.loading');
                window.location.href="uploadInfo-success.html";
            },
            error:function(){
                alert('请求超时')
            }
        })
    }

    function GetQueryString(name){
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r!=null)return  unescape(r[2]); return null;
    }

    $.ajax({
        url : Houst + '/api/demo/getDemoDetail',
        type: 'GET',
        dataType: 'JSON',
        data: {
            id: GetQueryString('id')
        },
        success : function(de){
            var detail = de.result;
            $('.backCase').text(detail.demoName);
            $('.backCase').click(function() {
                window.location.href="case-details.html?id=" + detail.id;
            });
        },
        error:function(){
            alert('请求超时');
        }
    });

</script>
</body>
</html>